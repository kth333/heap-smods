CREATE DATABASE IF NOT EXISTS `smods`;
USE `smods`;

DROP TABLE IF EXISTS `MUTUALLY_EXCLUSIVE`;
DROP TABLE IF EXISTS `CO_REQUISITE`;
DROP TABLE IF EXISTS `PRE_REQUISITE`;
DROP TABLE IF EXISTS `GRAD_REQUIREMENTS`;
DROP TABLE IF EXISTS `PLAN_MODULE_PREASSIGNED_GPA`;
DROP TABLE IF EXISTS `PLAN_MODULE_GPA`;
DROP TABLE IF EXISTS `USERS`;
DROP TABLE IF EXISTS `PLAN`;
DROP TABLE IF EXISTS `MODULE`;

CREATE TABLE `PLAN` (
    `PID` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `PName` VARCHAR(100) DEFAULT NULL,
    `Degree` VARCHAR(100) DEFAULT NULL,
    `Track` VARCHAR(100) DEFAULT NULL
) ENGINE=InnoDB;

CREATE TABLE `USERS` (
    `ID` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `Username` VARCHAR(16) NOT NULL,
    `Password` VARCHAR(255) NOT NULL,
    `Email` VARCHAR(255) NOT NULL,
    `Role` VARCHAR(50) NOT NULL,
    `EmailVerified` BOOLEAN NOT NULL,
    `VerificationCode` VARCHAR(6) NULL,
    `PID` INT,
    FOREIGN KEY (`PID`) REFERENCES `PLAN` (`PID`)
) ENGINE=InnoDB;

CREATE TABLE `MODULE` (
    `CID` VARCHAR(20) NOT NULL PRIMARY KEY,
    `CName` VARCHAR(100) NOT NULL,
    `CU` INT NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `PLAN_MODULE_GPA` (
    `PID` INT NOT NULL,
    `CID` VARCHAR(20) NOT NULL,
    `GPA` FLOAT,
    PRIMARY KEY (`PID`, `CID`),
    FOREIGN KEY (`PID`) REFERENCES `PLAN` (`PID`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;

CREATE TABLE `PLAN_MODULE_PREASSIGNED_GPA` (
    `PID` INT NOT NULL,
    `CID` VARCHAR(20) NOT NULL,
    `GPA` FLOAT,
    `Term` VARCHAR(100),
    PRIMARY KEY (`PID`, `CID`),
    FOREIGN KEY (`PID`) REFERENCES `PLAN` (`PID`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;

CREATE TABLE `GRAD_REQUIREMENTS` (
    `CID` VARCHAR(20) NOT NULL,
    `Requirements` VARCHAR(100),
    PRIMARY KEY (`CID`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;

CREATE TABLE `PRE_REQUISITE` (
    `CID` VARCHAR(20) NOT NULL,
    `CID2` VARCHAR(20) NOT NULL,
    PRIMARY KEY (`CID`, `CID2`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`),
    FOREIGN KEY (`CID2`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;

CREATE TABLE `CO_REQUISITE` (
    `CID` VARCHAR(20) NOT NULL,
    `CID2` VARCHAR(20) NOT NULL,
    PRIMARY KEY (`CID`, `CID2`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`),
    FOREIGN KEY (`CID2`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;

CREATE TABLE `MUTUALLY_EXCLUSIVE` (
    `CID` VARCHAR(20) NOT NULL,
    `CID2` VARCHAR(20) NOT NULL,
    PRIMARY KEY (`CID`, `CID2`),
    FOREIGN KEY (`CID`) REFERENCES `MODULE` (`CID`),
    FOREIGN KEY (`CID2`) REFERENCES `MODULE` (`CID`)
) ENGINE=InnoDB;
